# çŸ¥è¯†åº“ç®¡ç†æ¨¡å—

## æ¦‚è¿°

çŸ¥è¯†åº“ç®¡ç†æ¨¡å—æ˜¯ShopTalk-AIæ™ºèƒ½å®¢æœç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ï¼Œæä¾›ä¼ä¸šçº§çš„çŸ¥è¯†å†…å®¹ç®¡ç†ã€æ™ºèƒ½æ£€ç´¢ã€è‡ªåŠ¨åŒ–å¤„ç†ç­‰åŠŸèƒ½ã€‚è¯¥æ¨¡å—æ”¯æŒå¤šç§ç±»å‹çš„çŸ¥è¯†å†…å®¹ç®¡ç†ï¼ŒåŒ…æ‹¬æ–‡æ¡£ã€FAQã€å•†å“ä¿¡æ¯ã€è¯æœ¯æ¨¡æ¿ç­‰ã€‚

## ä¸»è¦åŠŸèƒ½

### ğŸ—ï¸ æ ¸å¿ƒåŠŸèƒ½

1. **çŸ¥è¯†åº“ç®¡ç†**
   - æ”¯æŒå¤šç§çŸ¥è¯†åº“ç±»å‹ï¼ˆå•†å“ã€FAQã€è¯æœ¯ã€æ”¿ç­–ã€æŠ€æœ¯æ–‡æ¡£ç­‰ï¼‰
   - çµæ´»çš„è®¿é—®æƒé™æ§åˆ¶
   - ç‰ˆæœ¬æ§åˆ¶å’ŒAIå¢å¼ºåŠŸèƒ½
   - ç»Ÿè®¡åˆ†æå’Œæ€§èƒ½ç›‘æ§

2. **æ–‡æ¡£ç®¡ç†**
   - æ”¯æŒå¤šç§æ–‡ä»¶æ ¼å¼ï¼ˆPDFã€Wordã€Excelã€æ–‡æœ¬ã€Markdownç­‰ï¼‰
   - è‡ªåŠ¨æ–‡æœ¬æå–å’Œå†…å®¹åˆ†æ
   - æ–‡æ¡£ç‰ˆæœ¬ç®¡ç†å’Œå˜æ›´è¿½è¸ª
   - æ™ºèƒ½å…³é”®è¯æå–å’Œæ‘˜è¦ç”Ÿæˆ

3. **FAQç®¡ç†**
   - é—®ç­”å¯¹çš„åˆ›å»ºã€ç¼–è¾‘å’Œåˆ†ç±»
   - æ™ºèƒ½é—®ç­”åŒ¹é…å’Œæ¨è
   - ç”¨æˆ·åé¦ˆå’Œè¯„åˆ†ç³»ç»Ÿ
   - AIè‡ªåŠ¨ç”ŸæˆFAQåŠŸèƒ½

4. **å•†å“ä¿¡æ¯ç®¡ç†**
   - å®Œæ•´çš„å•†å“ä¿¡æ¯åº“
   - åº“å­˜ç®¡ç†å’Œä»·æ ¼è·Ÿè¸ª
   - å¤šåª’ä½“èµ„æºç®¡ç†
   - SEOä¼˜åŒ–æ”¯æŒ

5. **è¯æœ¯æ¨¡æ¿ç®¡ç†**
   - å¤šåœºæ™¯è¯æœ¯æ¨¡æ¿
   - å˜é‡å’Œå ä½ç¬¦æ”¯æŒ
   - ä½¿ç”¨ç»Ÿè®¡å’Œæ•ˆæœåˆ†æ
   - AIè¯æœ¯ä¼˜åŒ–å»ºè®®

### ğŸ” æ™ºèƒ½æ£€ç´¢

1. **å¤šç»´åº¦æœç´¢**
   - å…¨æ–‡æœç´¢å’Œå…³é”®è¯åŒ¹é…
   - å‘é‡åŒ–è¯­ä¹‰æœç´¢
   - åˆ†ç±»å’Œæ ‡ç­¾ç­›é€‰
   - æƒé™è¿‡æ»¤å’Œä¸ªæ€§åŒ–æ’åº

2. **æ™ºèƒ½æ¨è**
   - åŸºäºç›¸ä¼¼åº¦çš„å†…å®¹æ¨è
   - ç”¨æˆ·è¡Œä¸ºåˆ†ææ¨è
   - çƒ­é—¨å†…å®¹æ¨è
   - AIç®—æ³•ä¼˜åŒ–æ¨è

### ğŸ“Š åˆ†æç»Ÿè®¡

1. **è®¿é—®ç»Ÿè®¡**
   - å†…å®¹è®¿é—®é‡åˆ†æ
   - ç”¨æˆ·è¡Œä¸ºè¿½è¸ª
   - æœç´¢çƒ­è¯ç»Ÿè®¡
   - å“åº”æ—¶é—´ç›‘æ§

2. **å†…å®¹åˆ†æ**
   - å†…å®¹è´¨é‡è¯„ä¼°
   - æ›´æ–°é¢‘ç‡åˆ†æ
   - ç”¨æˆ·æ»¡æ„åº¦ç»Ÿè®¡
   - çŸ¥è¯†è¦†ç›–åº¦åˆ†æ

### ğŸ¤– AIå¢å¼º

1. **è‡ªåŠ¨åŒ–å¤„ç†**
   - æ–‡æ¡£å†…å®¹è‡ªåŠ¨æå–
   - å…³é”®è¯æ™ºèƒ½æå–
   - æ‘˜è¦è‡ªåŠ¨ç”Ÿæˆ
   - åˆ†ç±»è‡ªåŠ¨æ¨è

2. **å‘é‡åŒ–å¤„ç†**
   - æ–‡æœ¬å‘é‡åŒ–å­˜å‚¨
   - è¯­ä¹‰ç›¸ä¼¼åº¦è®¡ç®—
   - æ™ºèƒ½èšç±»åˆ†æ
   - è´¨é‡è¯„åˆ†ä¼˜åŒ–

## æŠ€æœ¯æ¶æ„

### æ•°æ®æ¨¡å‹

```python
# æ ¸å¿ƒæ¨¡å‹å…³ç³»å›¾
KnowledgeBase (çŸ¥è¯†åº“)
â”œâ”€â”€ Document (æ–‡æ¡£)
â”œâ”€â”€ FAQ (é—®ç­”)
â”œâ”€â”€ Product (å•†å“)
â”œâ”€â”€ Script (è¯æœ¯)
â”œâ”€â”€ KnowledgeVector (å‘é‡)
â”œâ”€â”€ KnowledgeAccessRecord (è®¿é—®è®°å½•)
â””â”€â”€ KnowledgeRecommendation (æ¨è)

# è¾…åŠ©æ¨¡å‹
DocumentCategory (åˆ†ç±»)
DocumentTag (æ ‡ç­¾)
```

### æœåŠ¡æ¶æ„

```python
# æœåŠ¡å±‚ç»“æ„
DocumentProcessorService    # æ–‡æ¡£å¤„ç†æœåŠ¡
VectorizeService           # å‘é‡åŒ–æœåŠ¡
KnowledgeSearchService     # æœç´¢æœåŠ¡
RecommendationService      # æ¨èæœåŠ¡
KnowledgeAnalyticsService  # åˆ†æç»Ÿè®¡æœåŠ¡
```

### APIæ¥å£

```
# RESTful API ç«¯ç‚¹
GET    /api/v1/knowledge/knowledge-bases/          # è·å–çŸ¥è¯†åº“åˆ—è¡¨
POST   /api/v1/knowledge/knowledge-bases/          # åˆ›å»ºçŸ¥è¯†åº“
GET    /api/v1/knowledge/knowledge-bases/{id}/     # è·å–çŸ¥è¯†åº“è¯¦æƒ…
PUT    /api/v1/knowledge/knowledge-bases/{id}/     # æ›´æ–°çŸ¥è¯†åº“
DELETE /api/v1/knowledge/knowledge-bases/{id}/     # åˆ é™¤çŸ¥è¯†åº“

GET    /api/v1/knowledge/documents/               # è·å–æ–‡æ¡£åˆ—è¡¨
POST   /api/v1/knowledge/documents/upload/        # ä¸Šä¼ æ–‡æ¡£
GET    /api/v1/knowledge/documents/{id}/          # è·å–æ–‡æ¡£è¯¦æƒ…
POST   /api/v1/knowledge/documents/{id}/process/  # å¤„ç†æ–‡æ¡£
GET    /api/v1/knowledge/documents/{id}/download/ # ä¸‹è½½æ–‡æ¡£

POST   /api/v1/knowledge/search/search/           # æ™ºèƒ½æœç´¢
POST   /api/v1/knowledge/batch-operations/        # æ‰¹é‡æ“ä½œ
```

## å®‰è£…éƒ¨ç½²

### 1. ç¯å¢ƒè¦æ±‚

- Python 3.8+
- Django 4.2+
- PostgreSQL 12+
- Redis 6.0+
- Celery 5.0+

### 2. ä¾èµ–å®‰è£…

```bash
# æ ¸å¿ƒä¾èµ–
pip install Django>=4.2.7
pip install djangorestframework>=3.14.0
pip install psycopg2-binary>=2.9.7
pip install celery>=5.3.4
pip install redis>=5.0.1

# æ–‡æ¡£å¤„ç†ä¾èµ–
pip install PyPDF2>=3.0.1
pip install python-docx>=1.1.0
pip install openpyxl>=3.1.2

# AIå¤„ç†ä¾èµ–
pip install sentence-transformers>=2.2.2
pip install jieba>=0.42.1
pip install numpy>=1.24.3

# å‘é‡æ•°æ®åº“
pip install faiss-cpu>=1.7.4
# æˆ–
pip install chromadb>=0.4.15
```

### 3. æ•°æ®åº“é…ç½®

```python
# settings.py
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'shoptalk_ai',
        'USER': 'postgres',
        'PASSWORD': 'your_password',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}

# çŸ¥è¯†åº“é…ç½®
KNOWLEDGE_EMBEDDING_MODEL = 'paraphrase-multilingual-MiniLM-L12-v2'
KNOWLEDGE_CHUNK_SIZE = 512
KNOWLEDGE_CHUNK_OVERLAP = 50
```

### 4. åˆå§‹åŒ–æ•°æ®åº“

```bash
python manage.py makemigrations knowledge
python manage.py migrate
```

### 5. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨DjangoæœåŠ¡
python manage.py runserver

# å¯åŠ¨Celeryä»»åŠ¡é˜Ÿåˆ—
celery -A core worker -l info

# å¯åŠ¨Celeryå®šæ—¶ä»»åŠ¡
celery -A core beat -l info
```

## ä½¿ç”¨æŒ‡å—

### åˆ›å»ºçŸ¥è¯†åº“

```python
from apps.knowledge.models import KnowledgeBase

# åˆ›å»ºçŸ¥è¯†åº“
kb = KnowledgeBase.objects.create(
    name="å•†å“çŸ¥è¯†åº“",
    knowledge_type="product",
    description="åŒ…å«æ‰€æœ‰å•†å“ä¿¡æ¯çš„çŸ¥è¯†åº“",
    access_level="internal",
    enable_ai_enhancement=True,
    auto_extract_keywords=True,
    created_by=user
)
```

### ä¸Šä¼ æ–‡æ¡£

```python
from apps.knowledge.services import DocumentProcessorService

# ä¸Šä¼ å¹¶å¤„ç†æ–‡æ¡£
processor = DocumentProcessorService()
result = processor.process_document(document)

if result['success']:
    print(f"æ–‡æ¡£å¤„ç†æˆåŠŸ: {result['summary']}")
else:
    print(f"å¤„ç†å¤±è´¥: {result['error']}")
```

### æ™ºèƒ½æœç´¢

```python
from apps.knowledge.services import KnowledgeSearchService

# æ‰§è¡Œæœç´¢
search_service = KnowledgeSearchService()
results = search_service.search(
    query="å¦‚ä½•é€€è´§",
    knowledge_base_id=1,
    content_types=['document', 'faq'],
    limit=10,
    include_vectors=True
)

for result in results['results']:
    print(f"æ ‡é¢˜: {result['title']}")
    print(f"æ‘˜è¦: {result['summary']}")
    print(f"è¯„åˆ†: {result['score']}")
```

### ç”Ÿæˆæ¨è

```python
from apps.knowledge.services import RecommendationService

# ç”Ÿæˆæ¨è
rec_service = RecommendationService()
recommendations = rec_service.generate_recommendations(
    'document', document_id, knowledge_base_id, limit=5
)

for rec in recommendations:
    print(f"æ¨èå†…å®¹: {rec['content_type']}:{rec['content_id']}")
    print(f"ç›¸ä¼¼åº¦: {rec['score']}")
```

## APIä½¿ç”¨ç¤ºä¾‹

### 1. åˆ›å»ºçŸ¥è¯†åº“

```bash
curl -X POST http://localhost:8000/api/v1/knowledge/knowledge-bases/ \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your_token" \
  -d '{
    "name": "FAQçŸ¥è¯†åº“",
    "knowledge_type": "faq",
    "description": "å¸¸è§é—®é¢˜è§£ç­”",
    "access_level": "public",
    "enable_ai_enhancement": true
  }'
```

### 2. ä¸Šä¼ æ–‡æ¡£

```bash
curl -X POST http://localhost:8000/api/v1/knowledge/documents/upload/ \
  -H "Authorization: Bearer your_token" \
  -F "knowledge_base_id=1" \
  -F "title=äº§å“æ‰‹å†Œ" \
  -F "file=@product_manual.pdf" \
  -F "auto_extract=true" \
  -F "auto_vectorize=true"
```

### 3. æ™ºèƒ½æœç´¢

```bash
curl -X POST http://localhost:8000/api/v1/knowledge/search/search/ \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer your_token" \
  -d '{
    "query": "é€€è´§æ”¿ç­–",
    "knowledge_base_id": 1,
    "content_types": ["document", "faq"],
    "limit": 10,
    "include_vectors": true,
    "similarity_threshold": 0.7
  }'
```

### 4. è·å–åˆ†ææ•°æ®

```bash
curl -X GET "http://localhost:8000/api/v1/knowledge/knowledge-bases/1/analytics/?date_from=2024-01-01&date_to=2024-01-31" \
  -H "Authorization: Bearer your_token"
```

## å®šæ—¶ä»»åŠ¡

ç³»ç»Ÿæä¾›å¤šä¸ªå®šæ—¶ä»»åŠ¡æ¥ç»´æŠ¤çŸ¥è¯†åº“çš„å¥åº·çŠ¶æ€ï¼š

### é…ç½®å®šæ—¶ä»»åŠ¡

```python
# celery_beat_schedule.py
from celery.schedules import crontab

CELERY_BEAT_SCHEDULE = {
    # æ¯æ—¥ç»Ÿè®¡æ›´æ–°
    'update-knowledge-statistics': {
        'task': 'apps.knowledge.tasks.update_knowledge_base_statistics',
        'schedule': crontab(hour=2, minute=0),  # æ¯å¤©å‡Œæ™¨2ç‚¹
    },
    
    # æ–‡æ¡£å¤„ç†
    'process-pending-documents': {
        'task': 'apps.knowledge.tasks.process_pending_documents',
        'schedule': crontab(minute='*/10'),  # æ¯10åˆ†é’Ÿ
    },
    
    # è‡ªåŠ¨å‘é‡åŒ–
    'auto-vectorize-content': {
        'task': 'apps.knowledge.tasks.auto_vectorize_content',
        'schedule': crontab(minute='*/30'),  # æ¯30åˆ†é’Ÿ
    },
    
    # å¥åº·æ£€æŸ¥
    'health-check': {
        'task': 'apps.knowledge.tasks.health_check_knowledge_system',
        'schedule': crontab(minute='*/5'),  # æ¯5åˆ†é’Ÿ
    },
    
    # æ¸…ç†ä»»åŠ¡
    'cleanup-old-records': {
        'task': 'apps.knowledge.tasks.cleanup_old_access_records',
        'schedule': crontab(hour=3, minute=0),  # æ¯å¤©å‡Œæ™¨3ç‚¹
        'kwargs': {'days_to_keep': 90}
    },
}
```

## æ€§èƒ½ä¼˜åŒ–

### 1. æ•°æ®åº“ä¼˜åŒ–

```python
# ç´¢å¼•ä¼˜åŒ–
class Document(models.Model):
    class Meta:
        indexes = [
            models.Index(fields=['document_type']),
            models.Index(fields=['process_status']),
            models.Index(fields=['is_active']),
            models.Index(fields=['created_at']),
            models.Index(fields=['view_count']),
        ]
```

### 2. ç¼“å­˜é…ç½®

```python
# Redisç¼“å­˜é…ç½®
CACHES = {
    'default': {
        'BACKEND': 'django_redis.cache.RedisCache',
        'LOCATION': 'redis://127.0.0.1:6379/1',
        'OPTIONS': {
            'CLIENT_CLASS': 'django_redis.client.DefaultClient',
        }
    }
}

# ç¼“å­˜ä½¿ç”¨ç¤ºä¾‹
from django.core.cache import cache

def get_popular_documents(knowledge_base_id):
    cache_key = f"popular_docs_{knowledge_base_id}"
    result = cache.get(cache_key)
    
    if result is None:
        result = Document.objects.filter(
            knowledge_base_id=knowledge_base_id,
            is_active=True
        ).order_by('-view_count')[:10]
        
        cache.set(cache_key, result, 3600)  # ç¼“å­˜1å°æ—¶
    
    return result
```

### 3. å‘é‡æœç´¢ä¼˜åŒ–

```python
# FAISSç´¢å¼•ä¼˜åŒ–
import faiss
import numpy as np

class OptimizedVectorService:
    def __init__(self):
        self.index = None
        self.dimension = 384
    
    def build_index(self, vectors):
        """æ„å»ºFAISSç´¢å¼•"""
        vectors_array = np.array(vectors).astype('float32')
        
        # ä½¿ç”¨IVFç´¢å¼•æé«˜æœç´¢é€Ÿåº¦
        nlist = 100
        quantizer = faiss.IndexFlatIP(self.dimension)
        self.index = faiss.IndexIVFFlat(quantizer, self.dimension, nlist)
        
        # è®­ç»ƒç´¢å¼•
        self.index.train(vectors_array)
        self.index.add(vectors_array)
    
    def search(self, query_vector, k=10):
        """å¿«é€Ÿå‘é‡æœç´¢"""
        query_array = np.array([query_vector]).astype('float32')
        scores, indices = self.index.search(query_array, k)
        return scores[0], indices[0]
```

## ç›‘æ§å’Œæ—¥å¿—

### 1. æ—¥å¿—é…ç½®

```python
LOGGING = {
    'version': 1,
    'disable_existing_loggers': False,
    'handlers': {
        'knowledge_file': {
            'level': 'INFO',
            'class': 'logging.FileHandler',
            'filename': 'logs/knowledge.log',
        },
    },
    'loggers': {
        'knowledge': {
            'handlers': ['knowledge_file'],
            'level': 'INFO',
            'propagate': False,
        },
    },
}
```

### 2. æ€§èƒ½ç›‘æ§

```python
import time
import logging
from functools import wraps

logger = logging.getLogger('knowledge')

def monitor_performance(func):
    """æ€§èƒ½ç›‘æ§è£…é¥°å™¨"""
    @wraps(func)
    def wrapper(*args, **kwargs):
        start_time = time.time()
        try:
            result = func(*args, **kwargs)
            success = True
        except Exception as e:
            logger.error(f"å‡½æ•° {func.__name__} æ‰§è¡Œå¤±è´¥: {str(e)}")
            success = False
            raise
        finally:
            execution_time = time.time() - start_time
            logger.info(f"å‡½æ•° {func.__name__} æ‰§è¡Œæ—¶é—´: {execution_time:.2f}ç§’, æˆåŠŸ: {success}")
        
        return result
    return wrapper
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ–‡æ¡£å¤„ç†å¤±è´¥**
   ```python
   # æ£€æŸ¥æ–‡æ¡£çŠ¶æ€
   failed_docs = Document.objects.filter(process_status='failed')
   for doc in failed_docs:
       print(f"å¤±è´¥æ–‡æ¡£: {doc.title}, é”™è¯¯: {doc.process_message}")
   ```

2. **å‘é‡åŒ–å¤±è´¥**
   ```python
   # æ£€æŸ¥å‘é‡æ¨¡å‹
   from apps.knowledge.services import VectorizeService
   
   try:
       service = VectorizeService()
       model = service.get_embedding_model()
       print("å‘é‡æ¨¡å‹åŠ è½½æˆåŠŸ")
   except Exception as e:
       print(f"å‘é‡æ¨¡å‹åŠ è½½å¤±è´¥: {e}")
   ```

3. **æœç´¢æ€§èƒ½é—®é¢˜**
   ```python
   # æ£€æŸ¥ç´¢å¼•çŠ¶æ€
   from django.db import connection
   
   with connection.cursor() as cursor:
       cursor.execute("SELECT indexname, tablename FROM pg_indexes WHERE tablename LIKE 'knowledge_%'")
       indexes = cursor.fetchall()
       print("æ•°æ®åº“ç´¢å¼•:", indexes)
   ```

### æ€§èƒ½è°ƒä¼˜å»ºè®®

1. **æ•°æ®åº“ä¼˜åŒ–**
   - å®šæœŸæ›´æ–°è¡¨ç»Ÿè®¡ä¿¡æ¯
   - é€‚å½“è®¾ç½®æ•°æ®åº“è¿æ¥æ± 
   - ä½¿ç”¨è¯»å†™åˆ†ç¦»

2. **ç¼“å­˜ç­–ç•¥**
   - çƒ­é—¨å†…å®¹ç¼“å­˜
   - æœç´¢ç»“æœç¼“å­˜
   - å‘é‡è®¡ç®—ç»“æœç¼“å­˜

3. **å¼‚æ­¥å¤„ç†**
   - æ–‡æ¡£å¤„ç†å¼‚æ­¥åŒ–
   - å‘é‡è®¡ç®—å¼‚æ­¥åŒ–
   - æ¨èç”Ÿæˆå¼‚æ­¥åŒ–

## ç‰ˆæœ¬å†å²

### v1.0.0 (2024-01-15)
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- åŸºç¡€çŸ¥è¯†åº“ç®¡ç†åŠŸèƒ½
- æ–‡æ¡£ä¸Šä¼ å’Œå¤„ç†
- ç®€å•æœç´¢åŠŸèƒ½

### v1.1.0 (2024-01-20)
- æ·»åŠ å‘é‡åŒ–æœç´¢
- æ™ºèƒ½æ¨èåŠŸèƒ½
- åˆ†æç»Ÿè®¡æ¨¡å—

### v1.2.0 (2024-01-25)
- å®Œå–„ç®¡ç†åå°
- æ·»åŠ å®šæ—¶ä»»åŠ¡
- æ€§èƒ½ä¼˜åŒ–

## è´¡çŒ®æŒ‡å—

æ¬¢è¿ä¸ºçŸ¥è¯†åº“ç®¡ç†æ¨¡å—è´¡çŒ®ä»£ç ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
3. æäº¤æ›´æ”¹
4. åˆ›å»º Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ï¼Œè¯¦è§ LICENSE æ–‡ä»¶ã€‚

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿï¼š
- é‚®ç®±ï¼šdev@shoptalk-ai.com
- æ–‡æ¡£ï¼šhttps://docs.shoptalk-ai.com
- é—®é¢˜åé¦ˆï¼šhttps://github.com/shoptalk-ai/issues 